---
import { CollectionEntry, getCollection } from 'astro:content';
import BlogPost from '../../layouts/BlogPost.astro';
import FormattedDate from '../../components/FormattedDate.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('blog');

const { slug } = Astro.params;
const post = posts.find((page) => page.slug === slug);
if (!post) return Astro.redirect("/404");


console.log("Current Post:", post); // Log current post

const relatedPosts = posts
  .filter(otherPost =>
    otherPost.data.categories && // Ensure categories exist
    otherPost.data.categories.some(category =>
      post.data.categories && post.data.categories.includes(category)
    ) && otherPost.slug !== post.data.slug
  )
  .slice(0, 3); // Adjust the number of related posts to display as needed

  
console.log("Related Posts:", relatedPosts); // Log related posts

const { Content } = await post.render();
---

<BlogPost {...post.data}>
  <h1>{post.data.title}</h1>
  <Content />

  {/* Display related posts */}
  <h2>Related Posts</h2>
  <ul>
    {relatedPosts.map(relatedPost => (
      <li key={relatedPost.slug}>
        <a href={`/blog/${relatedPost.slug}`}>
          {relatedPost.data.title} - <FormattedDate date={relatedPost.data.pubDate} />
        </a>
      </li>
    ))}
  </ul>
</BlogPost>